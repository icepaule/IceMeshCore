; IceMeshCore - T-Beam Supreme SX1262 Repeater Configuration
;
; Dedicated LoRa repeater with OLED status display (SH1106 128x64).
; No WiFi/BLE - just LoRa packet forwarding + GPS + optional BME280 sensor.
;
; IMPORTANT: Change ADVERT_NAME and ADMIN_PASSWORD before building!
;
; Copy this file to: MeshCore/variants/lilygo_tbeam_supreme_SX1262/platformio.ini
;
; Build:  pio run -e T_Beam_S3_Supreme_SX1262_repeater
; Flash:  pio run -e T_Beam_S3_Supreme_SX1262_repeater -t upload
; Monitor: pio run -e T_Beam_S3_Supreme_SX1262_repeater -t monitor

; =============================================================================
; Base configuration for T-Beam Supreme SX1262 hardware
; (Board pinout, radio chip, display, GPS, PMU - DO NOT CHANGE)
; =============================================================================
[T_Beam_S3_Supreme_SX1262]
extends = esp32_base
board = t_beams3_supreme  ; LILYGO T-Beam Supreme ESP32S3 with SX1262
build_flags =
  ${esp32_base.build_flags}
  -I variants/lilygo_tbeam_supreme_SX1262
  -D TBEAM_SUPREME_SX1262
  -D SX126X_CURRENT_LIMIT=140
  -D SX126X_RX_BOOSTED_GAIN=1
  -D RADIO_CLASS=CustomSX1262
  -D WRAPPER_CLASS=CustomSX1262Wrapper
  -D DISPLAY_CLASS=SH1106Display
  -D LORA_TX_POWER=22
  -D P_LORA_TX_LED=6
  -D PIN_BOARD_SDA=17
  -D PIN_BOARD_SCL=18
  -D PIN_GPS_RX=8
  -D PIN_GPS_TX=9
  -D PIN_GPS_EN=7
  -D PIN_USER_BTN=0
  -D TELEM_BME280_ADDRESS=0x77
  -D ENV_INCLUDE_GPS=1
  -D ENV_INCLUDE_BME280=1
build_src_filter = ${esp32_base.build_src_filter}
  +<../variants/lilygo_tbeam_supreme_SX1262>
  +<helpers/ui/SH1106Display.cpp>
  +<helpers/esp32/TBeamBoard.cpp>
  +<helpers/sensors>
board_build.partitions = min_spiffs.csv
lib_deps =
  ${esp32_base.lib_deps}
  lewisxhe/XPowersLib @ ^0.2.7
  adafruit/Adafruit SH110X @ ^2.1.13
  stevemarple/MicroNMEA @ ^2.0.6
  adafruit/Adafruit BME280 Library @ ^2.3.0

; =============================================================================
; Repeater - dedicated LoRa relay node with OLED status display
;
; Features:
;   - Forwards mesh packets (flood + direct routing)
;   - OLED display with 3 status screens (button to cycle)
;   - GPS for automatic location
;   - Up to 50 neighbour tracking
;   - Remote management via mesh CLI
;
; >>> EDIT REPEATER NAME AND PASSWORD BELOW <<<
; =============================================================================
[env:T_Beam_S3_Supreme_SX1262_repeater]
extends = T_Beam_S3_Supreme_SX1262
build_flags =
  ${T_Beam_S3_Supreme_SX1262.build_flags}
  ;
  ; >>> CHANGE THESE TO YOUR SETTINGS <<<
  -D ADVERT_NAME='"MeinRepeater"'
  -D ADMIN_PASSWORD='"CHANGE_THIS_PASSWORD"'
  ;
  ; GPS coordinates (0 = use GPS fix automatically)
  -D ADVERT_LAT=0
  -D ADVERT_LON=0
  ;
  ; Neighbour tracking (how many nearby repeaters to remember)
  -D MAX_NEIGHBOURS=50
  ;
  ; EU Radio Settings (MUST match all other devices in your mesh!)
  ; Frequency: 869.618 MHz (EU g3 sub-band, legal in DE/AT/CH)
  ; Spreading Factor: 10 (long range)
  ; Bandwidth: 62.5 kHz (narrow = better sensitivity)
  ; Coding Rate: 4/5 (minimum FEC)
  -D LORA_FREQ=869.618
  -D LORA_BW=62.5
  -D LORA_SF=10
  -D LORA_CR=5
  ;
  ; TX Power: max 22 dBm for SX1262 (EU limit: 500 mW / 27 dBm ERP)
  ; -D LORA_TX_POWER=22  (already set in base config)
  ;
  ; Debug options (uncomment for troubleshooting):
  ; -D MESH_PACKET_LOGGING=1
  ; -D MESH_DEBUG=1
build_src_filter = ${T_Beam_S3_Supreme_SX1262.build_src_filter}
  +<../examples/simple_repeater>
lib_deps =
  ${T_Beam_S3_Supreme_SX1262.lib_deps}
  ${esp32_ota.lib_deps}
